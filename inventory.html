
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Alliance App - Inventory</title>
  <style>
    body { font-family: sans-serif; margin: 0; }
    .navbar { background: #1e293b; color: white; padding: 1rem; display: flex; justify-content: space-between; }
    .nav-links a { color: white; margin-left: 1rem; text-decoration: none; }
    .container { padding: 2rem; }
    table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
    th, td { padding: 0.75rem; border: 1px solid #ddd; text-align: left; }
    .btn { padding: 0.5rem 1rem; background: #007acc; color: white; border: none; border-radius: 6px; margin-top: 1rem; margin-right: 0.5rem; }
    .status-ok { background: #22c55e; color: white; padding: 4px 8px; border-radius: 6px; }
    .status-low { background: #facc15; color: black; padding: 4px 8px; border-radius: 6px; }
    .status-out { background: #ef4444; color: white; padding: 4px 8px; border-radius: 6px; }
    .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; }
    .modal-content { background: white; padding: 2rem; border-radius: 12px; width: 300px; }
    .modal-content input { width: 100%; padding: 8px; margin: 6px 0; }
  </style>
</head>
<body>
  <div id="header"></div>
<script>
fetch("header.html").then(r=>r.text()).then(t=>document.getElementById("header").innerHTML=t);
</script>
<!-- navbar removed -->
    <div><strong>Alliance App</strong></div>
    <div class="nav-links">
      <a href="index.html">Login</a>
      <a href="customers.html">Customers</a>
      <a href="inventory.html">Inventory</a>
      <a href="work-orders.html">Work Orders</a>
    </div>
  </div>

  <div class="container">
    <h2>Inventory</h2>
    <div>
      <label>Low Stock Threshold: </label>
      <input type="number" id="threshold" value="3" style="width: 60px;" onchange="renderInventory()" />
      <input type="text" id="search" placeholder="Search..." oninput="renderInventory()" style="margin-left: 1rem;" />
      <button class="btn" onclick="exportCSV()">Export CSV</button>
    </div>
    <table>
      <thead>
        <tr>
          <th>Item Name</th>
          <th>Description</th>
          <th>Quantity</th>
          <th>Cost</th>
          <th>Status</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="inventory-body"></tbody>
      <tfoot>
        <tr>
          <td colspan="2"><strong>Totals:</strong></td>
          <td id="totalQty"></td>
          <td id="totalCost"></td>
          <td colspan="2"></td>
        </tr>
      </tfoot>
    </table>
    <button class="btn" onclick="openModal('add')">Add Item</button>
  </div>

  <div id="modal" class="modal" style="display:none;">
    <div class="modal-content">
      <h3 id="modal-title">Add Item</h3>
      <input id="itemName" placeholder="Item Name" />
      <input id="itemDesc" placeholder="Description" />
      <input id="itemQty" placeholder="Quantity" type="number" />
      <input id="itemCost" placeholder="Cost" type="number" />
      <button class="btn" onclick="saveItem()">Save</button>
      <button class="btn" onclick="closeModal()">Cancel</button>
    </div>
  </div>

  <script>
    let items = JSON.parse(localStorage.getItem("inventory")) || [
      { name: "Oil Filter", desc: "Engine oil filter", qty: 10, cost: 15 },
      { name: "Brake Pad", desc: "Front brake pad", qty: 2, cost: 45 },
      { name: "Air Filter", desc: "Cabin air filter", qty: 0, cost: 12 }
    ];
    let editingIndex = -1;

    function renderInventory() {
      const threshold = parseInt(document.getElementById('threshold').value) || 3;
      const filter = document.getElementById('search').value.toLowerCase();
      const tbody = document.getElementById('inventory-body');
      let totalQty = 0, totalCost = 0;

      tbody.innerHTML = '';
      items.forEach((item, index) => {
        if (!item.name.toLowerCase().includes(filter)) return;
        const status = item.qty === 0 ? 'out' : item.qty <= threshold ? 'low' : 'ok';
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${item.name}</td>
          <td>${item.desc}</td>
          <td>${item.qty}</td>
          <td>$${item.cost.toFixed(2)}</td>
          <td><span class="status-${status}">${status.toUpperCase()}</span></td>
          <td>
            <button class="btn" onclick="editItem(${index})">Edit</button>
            <button class="btn" onclick="deleteItem(${index})">Delete</button>
          </td>
        `;
        totalQty += item.qty;
        totalCost += item.qty * item.cost;
        tbody.appendChild(tr);
      });

      document.getElementById('totalQty').textContent = totalQty;
      document.getElementById('totalCost').textContent = `$${totalCost.toFixed(2)}`;
      localStorage.setItem("inventory", JSON.stringify(items));
    }

    function openModal(mode) {
      editingIndex = mode === 'add' ? -1 : editingIndex;
      document.getElementById('modal-title').textContent = mode === 'add' ? 'Add Item' : 'Edit Item';
      document.getElementById('modal').style.display = 'flex';
      const fields = ['itemName', 'itemDesc', 'itemQty', 'itemCost'];
      if (editingIndex !== -1) {
        const item = items[editingIndex];
        document.getElementById('itemName').value = item.name;
        document.getElementById('itemDesc').value = item.desc;
        document.getElementById('itemQty').value = item.qty;
        document.getElementById('itemCost').value = item.cost;
      } else {
        fields.forEach(id => document.getElementById(id).value = '');
      }
    }

    function closeModal() {
      document.getElementById('modal').style.display = 'none';
    }

    function saveItem() {
      const name = document.getElementById('itemName').value.trim();
      const desc = document.getElementById('itemDesc').value.trim();
      const qty = parseInt(document.getElementById('itemQty').value.trim());
      const cost = parseFloat(document.getElementById('itemCost').value.trim());

      if (!name || isNaN(qty) || isNaN(cost)) return alert("All fields are required.");
      const exists = items.find((item, i) => item.name.toLowerCase() === name.toLowerCase() && i !== editingIndex);
      if (exists) return alert("Item name must be unique.");

      if (editingIndex === -1) {
        items.push({ name, desc, qty, cost });
      } else {
        items[editingIndex] = { name, desc, qty, cost };
      }
      closeModal();
      renderInventory();
    }

    function editItem(index) {
      editingIndex = index;
      openModal('edit');
    }

    function deleteItem(index) {
      if (confirm("Delete this item?")) {
        items.splice(index, 1);
        renderInventory();
      }
    }

    function exportCSV() {
      const headers = ["Item Name", "Description", "Quantity", "Cost"];
      const rows = items.map(i => [i.name, i.desc, i.qty, i.cost.toFixed(2)]);
      const csvContent = [headers, ...rows].map(e => e.join(",")).join("\n");
      const blob = new Blob([csvContent], { type: "text/csv" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "inventory.csv";
      a.click();
      URL.revokeObjectURL(url);
    }

    renderInventory();
  </script>
</body>
</html>
